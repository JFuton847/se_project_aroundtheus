!function(){"use strict";class e{constructor(e,t,s,r,i){let{name:n,link:o,_id:a,isLiked:l}=e;this._name=n,this._link=o,this._id=a,this._cardSelector=t,this._handleImageClick=s,this.handleDeleteClick=r,this.handleLikeClick=i,this.isLiked=l}_setEventListeners(){this._cardElement.querySelector(".card__like-button").addEventListener("click",(e=>{e.stopPropagation(),this.handleLikeClick(this)})),this._cardElement.querySelector(".card__delete-button").addEventListener("click",(e=>{e.stopPropagation(),this.handleDeleteClick(this._id,this._cardElement)})),this._cardElement.addEventListener("click",(e=>{e.stopPropagation(),this._handleImageClick(this._name,this._link)}))}likeCard(){this._cardElement.querySelector(".card__like-button").classList.add("card__like-button_active")}unlikeCard(){this._cardElement.querySelector(".card__like-button").classList.remove("card__like-button_active")}handleLikeIcon(e){void 0!==e&&(this.isLiked=e),this.isLiked?this.likeCard():this.unlikeCard()}handleDeleteCard(){this._cardElement.remove(),this._cardElement=null}_getTemplate(){const e=document.querySelector(this._cardSelector);if(!e)throw new Error(`Template selector "${this._cardSelector}" not found.`);return e.content.querySelector(".card").cloneNode(!0)}getView(){this._cardElement=this._getTemplate(),this._cardElement.setAttribute("data-id",this._id),this._setEventListeners();const e=this._cardElement.querySelector(".card__image");return e.src=this._link,e.alt=`Image of ${this._name}`,this._cardElement.querySelector(".card__title").textContent=this._name,this.handleLikeIcon(this.isLiked),this._cardElement}}class t{constructor(e,t){this._formEl=e,this._formSelector=t.formSelector,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass}_checkInputValidity(e){if(!e.validity.valid)return this._showInputError(e);this._hideInputError(e)}_hideInputError(e){const t=this._formEl.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_showInputError(e){const t=this._formEl.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hasInvalidInput(){return this._inputEls.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?this.disableButton():this._enableButton()}disableButton(){this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0}_enableButton(){this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.disabled=!1}_setEventListeners(){this._inputEls=[...this._formEl.querySelectorAll(this._inputSelector)],this._submitButton=this._formEl.querySelector(this._submitButtonSelector),this._inputEls.forEach((e=>{e.addEventListener("input",(t=>{this._checkInputValidity(e),this._toggleButtonState()}))})),this._toggleButtonState()}enableValidation(){this._formEl.addEventListener("reset",(()=>{this.disableButton()})),this._setEventListeners()}}class s{constructor(e){this._popupElement=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popupElement.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popupElement.addEventListener("mousedown",(e=>{(e.target.classList.contains("modal_opened")||e.target.classList.contains("modal__close-button"))&&this.close()}))}}var r=class extends s{constructor(e,t){super(e),this._popupForm=this._popupElement.querySelector(".modal__form"),this._handleCardFormSubmit=t,this._inputList=this._popupForm.querySelectorAll(".modal__form-input"),this._submitButton=this._popupForm.querySelector(".modal__save-button"),this._submitButtonOriginalText=this._submitButton.textContent}renderLoading(e){this._submitButton.textContent=e?"Saving...":this._submitButtonOriginalText}_getInputValues(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}disableSubmitButton(){this._submitButton.disabled=!0}enableSubmitButton(){this._submitButton.disabled=!1}setEventListeners(){this._popupForm.addEventListener("submit",(e=>{e.preventDefault();const t=this._getInputValues();this.renderLoading(!0),this.disableSubmitButton(),this._handleCardFormSubmit(t).then((()=>{console.log("Success:",t),this.close(),this._popupForm.reset()})).catch((e=>{console.error(`ERROR DURING FORM SUBMISSION: ${e}`)})).finally((()=>{this.renderLoading(!1),this.enableSubmitButton()}))})),super.setEventListeners()}};const i={inputSelector:".modal__form-input",submitButtonSelector:".modal__save-button",inactiveButtonClass:"modal__save-button_disabled",inputErrorClass:"modal__form-input_type_error",errorClass:"modal__error_visible"};var n=class{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}};document.querySelector(".profile__name"),document.querySelector(".profile__title");const o=document.querySelector("#profile-name-input"),a=(document.querySelector("#image-url-input"),document.querySelector("#profile-title-input")),l=document.querySelector("#profile-edit-modal"),d=l.querySelector("#profile-modal-form"),c=document.querySelector("#update-avatar-modal").querySelector("#update-avatar-form"),u=document.querySelector("#add-card-modal"),h=u.querySelector("#add-card-form"),_=(document.querySelector(".cards"),document.querySelector("#card-template").content.firstElementChild,h.querySelector("#card-title-input"),h.querySelector("#image-url-input"),document.querySelectorAll(".modal"),document.querySelector("#avatar-edit-button")),m=(document.querySelector("#profile-edit-button"),l.querySelector("#profile-edit-close-button"),document.querySelector(".profile__add-button")),p=(u.querySelector("#add-card-close-button"),document.querySelector("#preview-image-close-button"),new r("#profile-edit-modal",(e=>U.updateUserProfile({name:e.name,about:e.about}).then((()=>{y.setUserInfo({name:e.name,about:e.about})}))))),E=new r("#add-card-modal",(e=>{const t=e.title,s=e.url;return U.createCards({name:t,link:s}).then((e=>{const t=q(e);R.addItem(t)}))}));E.setEventListeners();const v=new r("#update-avatar-modal",(e=>U.updateAvatar({avatar:e.avatar}).then((e=>{y.setUserAvatar({avatar:e.avatar})}))));_.addEventListener("click",(()=>{v.open()})),v.setEventListeners(),m.addEventListener("click",(()=>E.open())),document.querySelector("#profile-edit-button").addEventListener("click",(()=>{const{name:e,about:t}=y.getUserInfo();o.value=e,a.value=t,p.open()}));const b=new t(d,i),S=new t(h,i),f=new t(c,i);S.enableValidation(),b.enableValidation(),f.enableValidation(),p.setEventListeners();const C=new class extends s{constructor(e){super(e),this._image=document.querySelector("#modal-image"),this._caption=document.querySelector("#modal-preview-image-title")}open(e){this._image.src=e.link,this._image.alt=e.name,this._caption.textContent=e.name,super.open()}}("#preview-image-modal");function L(e,t){C.open({name:e,link:t})}C.setEventListeners();const y=new class{constructor(e){let{profileNameSelector:t,aboutSelector:s,avatarSelector:r}=e;this._profileName=document.querySelector(t),this._profileTitle=document.querySelector(s),this._profileAvatar=document.querySelector(r)}getUserInfo(){return{name:this._profileName.textContent,about:this._profileTitle.textContent,avatar:this._profileAvatar.url}}setUserInfo(e){let{name:t,about:s}=e;this._profileName.textContent=t,this._profileTitle.textContent=s}setUserAvatar(e){let{avatar:t}=e;this._profileAvatar.src=t}}({profileNameSelector:".profile__name",aboutSelector:".profile__title",avatarSelector:".profile__avatar"}),k=new class extends s{constructor(e,t){super(e),this._handleConfirm=t,this._confirmButton=document.querySelector(".modal__save-button_confirmation"),this._setEventListeners()}open(e,t){super.open(),this._cardId=e,this._cardElement=t}_setEventListeners(){super.setEventListeners(),this._confirmButton.addEventListener("click",(()=>{this._handleConfirm(this._cardId,this._cardElement).then((()=>{this.close()})).catch((e=>{console.error("Error Deleting Cards:",e)}))}))}}(".modal__confirm",((e,t)=>U.deleteCard(e).then((()=>{t.remove()})).catch((e=>{console.error(`ERROR DELETING CARD ${e}`)}))));function g(e,t){k.open(e,t)}function q(t){return new e({...t,isLiked:t.isLiked},"#card-template",L,g,I).getView()}function I(e){e.isLiked?U.dislikeACard(e._id).then((()=>{e.unlikeCard(),e.isLiked=!1})).catch((e=>{console.error(`ERROR DISLIKING CARD ${e}`)})):U.likeACard(e._id).then((t=>{e.likeCard(),e.isLiked=!0})).catch((e=>{console.error(`ERROR LIKING CARD ${e}`)}))}function B(e){const t=q(e);R.addItem(t)}let R;const U=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}_handleResponse(e){return e.ok?e.json():Promise.reject(new Error(`Error ${e.status}: ${e.statusText}`))}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{method:"GET",headers:this._headers}).then(this._handleResponse)}createCards(e){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify(e)}).then(this._handleResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._handleResponse)}likeACard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._handleResponse)}dislikeACard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._handleResponse)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{method:"GET",headers:this._headers}).then(this._handleResponse)}updateUserProfile(e){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._handleResponse)}updateAvatar(e){let{avatar:t}=e;return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})}).then(this._handleResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"642370a4-ceb6-4d04-bc83-246d61a4c38e","Content-Type":"application/json"}});U.getInitialCards().then((e=>{console.log("Fetched cards:",e),R=new n({items:e.reverse(),renderer:B},".cards"),R.renderItems()})).catch((e=>{console.error(`ERROR FETCHING CARDS ${e}`)})),U.getUserInfo().then((e=>{console.log("Fetched user data:",e),y.setUserInfo({name:e.name,about:e.about}),y.setUserAvatar({avatar:e.avatar})})).catch((e=>{console.error(`ERROR FETCHING USER INFO ${e}`)}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFLK0ssMkJBQTRCLENBQy9DWSxPQUFRLFFBQ1JiLFFBQVM5SyxLQUFLZ0wsU0FDZFksS0FBTUMsS0FBS0MsVUFBVSxDQUFFOUMsT0FBUUEsTUFDOUIvQyxLQUFLakcsS0FBS2lMLGdCQUNmLEdKK0lrQixDQUNsQkosUUFBUyxrREFDVEMsUUFBUyxDQUNQaUIsY0FBZSx1Q0FDZixlQUFnQixzQkFJcEI5RCxFQUNHd0Qsa0JBQ0F4RixNQUFNK0YsSUFDTDlGLFFBQVFDLElBQUksaUJBQWtCNkYsR0FDOUJuRCxFQUFVLElBQUlvRCxFQUFRLENBQUV0RixNQUFPcUYsRUFBTUUsVUFBV3RGLFlBQVksVUFDNURpQyxFQUFRN0IsYUFBYSxJQUV0QlgsT0FBT0MsSUFDTkosUUFBUUssTUFBTSx3QkFBd0JELElBQU0sSUFHaEQyQixFQUNHa0IsY0FDQWxELE1BQU1nRCxJQUNML0MsUUFBUUMsSUFBSSxxQkFBc0I4QyxHQUNsQ2IsRUFBU0MsWUFBWSxDQUNuQnpJLEtBQU1xSixFQUFTckosS0FDZnVJLE1BQU9jLEVBQVNkLFFBRWxCQyxFQUFTYyxjQUFjLENBQ3JCRixPQUFRQyxFQUFTRCxRQUNqQixJQUVIM0MsT0FBT0MsSUFDTkosUUFBUUssTUFBTSw0QkFBNEJELElBQU0sRyIsInNvdXJjZXMiOlsid2VicGFjazovL3RyaXBsZXRlbi8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vdHJpcGxldGVuLy4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly90cmlwbGV0ZW4vLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly90cmlwbGV0ZW4vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3RyaXBsZXRlbi8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vdHJpcGxldGVuLy4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly90cmlwbGV0ZW4vLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vdHJpcGxldGVuLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vdHJpcGxldGVuLy4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vdHJpcGxldGVuLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoQ29uZmlybWF0aW9uLmpzIiwid2VicGFjazovL3RyaXBsZXRlbi8uL3NyYy9jb21wb25lbnRzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcbiAgY29uc3RydWN0b3IoXG4gICAgeyBuYW1lLCBsaW5rLCBfaWQsIGlzTGlrZWQgfSxcbiAgICBjYXJkU2VsZWN0b3IsXG4gICAgaGFuZGxlSW1hZ2VDbGljayxcbiAgICBoYW5kbGVEZWxldGVDbGljayxcbiAgICBoYW5kbGVMaWtlQ2xpY2tcbiAgKSB7XG4gICAgdGhpcy5fbmFtZSA9IG5hbWU7XG4gICAgdGhpcy5fbGluayA9IGxpbms7XG4gICAgdGhpcy5faWQgPSBfaWQ7XG4gICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xuICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2sgPSBoYW5kbGVJbWFnZUNsaWNrO1xuICAgIHRoaXMuaGFuZGxlRGVsZXRlQ2xpY2sgPSBoYW5kbGVEZWxldGVDbGljaztcbiAgICB0aGlzLmhhbmRsZUxpa2VDbGljayA9IGhhbmRsZUxpa2VDbGljaztcbiAgICB0aGlzLmlzTGlrZWQgPSBpc0xpa2VkO1xuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIC8vXCIuY2FyZF9fbGlrZS1idXR0b25cIlxuICAgIHRoaXMuX2NhcmRFbGVtZW50XG4gICAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLmhhbmRsZUxpa2VDbGljayh0aGlzKTtcbiAgICAgIH0pO1xuICAgIC8vIChcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpO1xuICAgIHRoaXMuX2NhcmRFbGVtZW50XG4gICAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIC8vIGNhbGwgdGhlIGZ1bmN0aW9uIHBhc3NlZCBhcyBhbiBhcmd1bWVudFxuICAgICAgICAvLyBwYXNzIHRoaXMgYXMgYXJndW1lbnRcbiAgICAgICAgdGhpcy5oYW5kbGVEZWxldGVDbGljayh0aGlzLl9pZCwgdGhpcy5fY2FyZEVsZW1lbnQpO1xuICAgICAgfSk7XG4gICAgLy8gVE9ETyAtIGFkZCBsaXN0ZW5lciBmb3IgaW1hZ2UgZWxlbWVudFxuICAgIHRoaXMuX2NhcmRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2sodGhpcy5fbmFtZSwgdGhpcy5fbGluayk7XG4gICAgfSk7XG4gIH1cblxuICBsaWtlQ2FyZCgpIHtcbiAgICB0aGlzLl9jYXJkRWxlbWVudFxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIilcbiAgICAgIC5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICB9XG5cbiAgdW5saWtlQ2FyZCgpIHtcbiAgICB0aGlzLl9jYXJkRWxlbWVudFxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIilcbiAgICAgIC5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICB9XG5cbiAgaGFuZGxlTGlrZUljb24oaXNMaWtlZCkge1xuICAgIGlmIChpc0xpa2VkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuaXNMaWtlZCA9IGlzTGlrZWQ7XG4gICAgfVxuICAgIGlmICh0aGlzLmlzTGlrZWQpIHtcbiAgICAgIHRoaXMubGlrZUNhcmQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy51bmxpa2VDYXJkKCk7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlRGVsZXRlQ2FyZCgpIHtcbiAgICB0aGlzLl9jYXJkRWxlbWVudC5yZW1vdmUoKTtcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IG51bGw7XG4gIH1cblxuICBfZ2V0VGVtcGxhdGUoKSB7XG4gICAgY29uc3QgdGVtcGxhdGVFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkU2VsZWN0b3IpO1xuICAgIGlmICghdGVtcGxhdGVFbGVtZW50KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRlbXBsYXRlIHNlbGVjdG9yIFwiJHt0aGlzLl9jYXJkU2VsZWN0b3J9XCIgbm90IGZvdW5kLmApO1xuICAgIH1cbiAgICByZXR1cm4gdGVtcGxhdGVFbGVtZW50LmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpLmNsb25lTm9kZSh0cnVlKTtcbiAgfVxuXG4gIGdldFZpZXcoKSB7XG4gICAgdGhpcy5fY2FyZEVsZW1lbnQgPSB0aGlzLl9nZXRUZW1wbGF0ZSgpO1xuICAgIHRoaXMuX2NhcmRFbGVtZW50LnNldEF0dHJpYnV0ZShcImRhdGEtaWRcIiwgdGhpcy5faWQpO1xuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgY29uc3QgY2FyZEltYWdlID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgICBjYXJkSW1hZ2Uuc3JjID0gdGhpcy5fbGluaztcbiAgICBjYXJkSW1hZ2UuYWx0ID0gYEltYWdlIG9mICR7dGhpcy5fbmFtZX1gO1xuICAgIHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIikudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xuICAgIHRoaXMuaGFuZGxlTGlrZUljb24odGhpcy5pc0xpa2VkKTtcbiAgICByZXR1cm4gdGhpcy5fY2FyZEVsZW1lbnQ7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuICBjb25zdHJ1Y3Rvcihmb3JtRWxlbWVudCwgc2V0dGluZ3MpIHtcbiAgICAvLyBhc3NpZ24gdGhpbmcgdG8gdGhpcyBvYmplY3RcbiAgICB0aGlzLl9mb3JtRWwgPSBmb3JtRWxlbWVudDtcbiAgICAvLyB0aGlzLl9zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgIHRoaXMuX2Zvcm1TZWxlY3RvciA9IHNldHRpbmdzLmZvcm1TZWxlY3RvcjtcbiAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gc2V0dGluZ3MuaW5wdXRTZWxlY3RvcjtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvciA9IHNldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yO1xuICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MgPSBzZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzO1xuICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcztcbiAgICB0aGlzLl9lcnJvckNsYXNzID0gc2V0dGluZ3MuZXJyb3JDbGFzcztcbiAgfVxuXG4gIF9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbCkge1xuICAgIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWwpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsKTtcbiAgICB9XG4gIH1cblxuICBfaGlkZUlucHV0RXJyb3IoaW5wdXRFbCkge1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZUVsID0gdGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gICAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XG4gICAgZXJyb3JNZXNzYWdlRWwudGV4dENvbnRlbnQgPSBcIlwiO1xuICAgIGVycm9yTWVzc2FnZUVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fZXJyb3JDbGFzcyk7XG4gIH1cblxuICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbCkge1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZUVsID0gdGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gICAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XG4gICAgZXJyb3JNZXNzYWdlRWwudGV4dENvbnRlbnQgPSBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlO1xuICAgIGVycm9yTWVzc2FnZUVsLmNsYXNzTGlzdC5hZGQodGhpcy5fZXJyb3JDbGFzcyk7XG4gIH1cblxuICBfaGFzSW52YWxpZElucHV0KCkge1xuICAgIHJldHVybiB0aGlzLl9pbnB1dEVscy5zb21lKChpbnB1dEVsKSA9PiAhaW5wdXRFbC52YWxpZGl0eS52YWxpZCk7XG4gIH1cblxuICBfdG9nZ2xlQnV0dG9uU3RhdGUoKSB7XG4gICAgaWYgKHRoaXMuX2hhc0ludmFsaWRJbnB1dCgpKSB7XG4gICAgICB0aGlzLmRpc2FibGVCdXR0b24oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fZW5hYmxlQnV0dG9uKCk7XG4gICAgfVxuICB9XG5cbiAgZGlzYWJsZUJ1dHRvbigpIHtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICB9XG5cbiAgX2VuYWJsZUJ1dHRvbigpIHtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxuXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9pbnB1dEVscyA9IFsuLi50aGlzLl9mb3JtRWwucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKV07XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uID0gdGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3IodGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuICAgIHRoaXMuX2lucHV0RWxzLmZvckVhY2goKGlucHV0RWwpID0+IHtcbiAgICAgIGlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIChlKSA9PiB7XG4gICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsKTtcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgfVxuXG4gIC8vIF9jbGVhckZvcm1GaWVsZHMoKSB7XG4gIC8vICAgdGhpcy5faW5wdXRFbHMuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xuICAvLyAgICAgaW5wdXRFbC52YWx1ZSA9IFwiXCI7XG4gIC8vICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsKTtcbiAgLy8gICB9KTtcbiAgLy8gfVxuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fZm9ybUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNldFwiLCAoKSA9PiB7XG4gICAgICB0aGlzLmRpc2FibGVCdXR0b24oKTtcbiAgICB9KTtcblxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgLy8gbG9vayBmb3IgYWxsIGlucHV0cyBpbnNpZGUgb2YgZm9ybVxuICAgIC8vIGxvb3AgdGhyb3VnaCBhbGwgdGhlIGlucHV0cyB0byBzZWUgaWYgYWxsIGFyZSB2YWxpZFxuICAgIC8vIGlmIGlucHV0IG5vdCB2YWxpZFxuICAgIC8vIGdldCB0aGUgdmFsaWRhdGlvbiBtc2dcbiAgICAvLyBhZGQgZXJyb3IgY2xhc3MgdG8gaW5wdXRcbiAgICAvLyBkaXNwbGF5IGVycm9yIG1zZ1xuICAgIC8vIGRpc2FibGUgYnV0dG9uXG4gICAgLy8gaWYgYWxsIGlucHV0cyBhcmUgdmFsaWRcbiAgICAvLyByZXNldCBlcnJvciBtc2dzXG4gICAgLy8gfSk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgIHRoaXMuX3BvcHVwRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5faGFuZGxlRXNjQ2xvc2UgPSB0aGlzLl9oYW5kbGVFc2NDbG9zZS5iaW5kKHRoaXMpO1xuICB9XG5cbiAgb3BlbigpIHtcbiAgICAvLyBvcGVucyBwb3B1cFxuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIC8vIGNsb3NlcyBwb3B1cFxuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgfVxuXG4gIF9oYW5kbGVFc2NDbG9zZShldnQpIHtcbiAgICAvL2xpc3RlbnMgZm9yIGVzYyBidXR0b25cbiAgICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8vIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAvLyAgIHRoaXMuX3BvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5faGFuZGxlT3ZlcmxheSk7XG4gIC8vICAgY29uc3QgY2xvc2VCdXR0b24gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgLy8gICAgIFwiLm1vZGFsX19jbG9zZS1idXR0b25cIlxuICAvLyAgICk7XG4gIC8vICAgY2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuY2xvc2UoKSk7XG4gIC8vIH1cblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZXZ0KSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfb3BlbmVkXCIpIHx8XG4gICAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfX2Nsb3NlLWJ1dHRvblwiKVxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGhhbmRsZUNhcmRGb3JtU3VibWl0KSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5fcG9wdXBGb3JtID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG4gICAgdGhpcy5faGFuZGxlQ2FyZEZvcm1TdWJtaXQgPSBoYW5kbGVDYXJkRm9ybVN1Ym1pdDtcbiAgICB0aGlzLl9pbnB1dExpc3QgPSB0aGlzLl9wb3B1cEZvcm0ucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9fZm9ybS1pbnB1dFwiKTtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24gPSB0aGlzLl9wb3B1cEZvcm0ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc2F2ZS1idXR0b25cIik7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uT3JpZ2luYWxUZXh0ID0gdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50O1xuICB9XG5cbiAgcmVuZGVyTG9hZGluZyhpc0xvYWRpbmcpIHtcbiAgICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSB0aGlzLl9zdWJtaXRCdXR0b25PcmlnaW5hbFRleHQ7XG4gICAgfVxuICB9XG5cbiAgX2dldElucHV0VmFsdWVzKCkge1xuICAgIGNvbnN0IGZvcm1WYWx1ZXMgPSB7fTtcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIGZvcm1WYWx1ZXNbaW5wdXQubmFtZV0gPSBpbnB1dC52YWx1ZTtcbiAgICB9KTtcbiAgICByZXR1cm4gZm9ybVZhbHVlcztcbiAgfVxuXG4gIC8vIG9wZW4oKSB7XG4gIC8vICAgc3VwZXIub3BlbigpO1xuICAvLyB9XG5cbiAgZGlzYWJsZVN1Ym1pdEJ1dHRvbigpIHtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICB9XG5cbiAgZW5hYmxlU3VibWl0QnV0dG9uKCkge1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICB9XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fcG9wdXBGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2ZW50KSA9PiB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgY29uc3QgZm9ybURhdGEgPSB0aGlzLl9nZXRJbnB1dFZhbHVlcygpO1xuICAgICAgdGhpcy5yZW5kZXJMb2FkaW5nKHRydWUpO1xuICAgICAgdGhpcy5kaXNhYmxlU3VibWl0QnV0dG9uKCk7XG4gICAgICB0aGlzLl9oYW5kbGVDYXJkRm9ybVN1Ym1pdChmb3JtRGF0YSlcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBTdWNjZXNzOmAsIGZvcm1EYXRhKTtcbiAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgdGhpcy5fcG9wdXBGb3JtLnJlc2V0KCk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihgRVJST1IgRFVSSU5HIEZPUk0gU1VCTUlTU0lPTjogJHtlcnJ9YCk7XG4gICAgICAgIH0pXG4gICAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgICB0aGlzLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xuICAgICAgICAgIHRoaXMuZW5hYmxlU3VibWl0QnV0dG9uKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUG9wdXBXaXRoRm9ybTtcbiIsImV4cG9ydCBjb25zdCBpbml0aWFsQ2FyZHMgPSBbXG4gIHtcbiAgICBuYW1lOiBcIllvc2VtaXRlIFZhbGxleVwiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC95b3NlbWl0ZS5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiTGFrZSBMb3Vpc2VcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvbGFrZS1sb3Vpc2UuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkJhbGQgTW91bnRhaW5zXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L2JhbGQtbW91bnRhaW5zLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJMYXRlbWFyXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L2xhdGVtYXIuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIlZhbm9pc2UgTmF0aW9uYWwgUGFya1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC92YW5vaXNlLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJMYWdvXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L2xhZ28uanBnXCIsXG4gIH0sXG5dO1xuXG5leHBvcnQgY29uc3QgdmFsaWRhdGlvblNldHRpbmdzID0ge1xuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybS1pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3NhdmUtYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3NhdmUtYnV0dG9uX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9fZm9ybS1pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIixcbn07XG4iLCJjbGFzcyBTZWN0aW9uIHtcbiAgY29uc3RydWN0b3IoeyBpdGVtcywgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcbiAgICB0aGlzLl9pdGVtcyA9IGl0ZW1zO1xuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XG4gIH1cblxuICAvLyBQdWJsaWMgbWV0aG9kIHRvIHJlbmRlciBhbGwgaXRlbXNcbiAgcmVuZGVySXRlbXMoKSB7XG4gICAgdGhpcy5faXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgdGhpcy5fcmVuZGVyZXIoaXRlbSk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBQdWJsaWMgbWV0aG9kIHRvIGFkZCBhIHNpbmdsZSBpdGVtIHRvIHRoZSBjb250YWluZXJcbiAgYWRkSXRlbShlbGVtZW50KSB7XG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoZWxlbWVudCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU2VjdGlvbjtcbiIsImltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCBQb3B1cCBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cC5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aEltYWdlIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcbmltcG9ydCBcIi4uL3BhZ2VzL2luZGV4LmNzc1wiO1xuaW1wb3J0IHsgaW5pdGlhbENhcmRzLCB2YWxpZGF0aW9uU2V0dGluZ3MgfSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aENvbmZpcm1hdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhDb25maXJtYXRpb24uanNcIjtcblxuLy8gTW9kYWxzXG5jb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcbmNvbnN0IHByb2ZpbGVUaXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fdGl0bGVcIik7XG5jb25zdCBwcm9maWxlTmFtZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLW5hbWUtaW5wdXRcIik7XG5jb25zdCBpbWFnZVVybElucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNpbWFnZS11cmwtaW5wdXRcIik7XG5jb25zdCBwcm9maWxlVGl0bGVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS10aXRsZS1pbnB1dFwiKTtcbmNvbnN0IHByb2ZpbGVFZGl0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtZWRpdC1tb2RhbFwiKTtcbmNvbnN0IHByb2ZpbGVFZGl0Rm9ybSA9IHByb2ZpbGVFZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLW1vZGFsLWZvcm1cIik7XG5jb25zdCBhdmF0YXJFZGl0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3VwZGF0ZS1hdmF0YXItbW9kYWxcIik7XG5jb25zdCBhdmF0YXJFZGl0Rm9ybSA9IGF2YXRhckVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3VwZGF0ZS1hdmF0YXItZm9ybVwiKTtcbmNvbnN0IGFkZENhcmRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtbW9kYWxcIik7XG5jb25zdCBhZGRDYXJkRm9ybSA9IGFkZENhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1jYXJkLWZvcm1cIik7XG5jb25zdCBjYXJkTGlzdEVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc1wiKTtcbmNvbnN0IGNhcmRUZW1wbGF0ZSA9XG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKS5jb250ZW50LmZpcnN0RWxlbWVudENoaWxkO1xuY29uc3QgY2FyZFRpdGxlSW5wdXQgPSBhZGRDYXJkRm9ybS5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGl0bGUtaW5wdXRcIik7XG5jb25zdCBjYXJkVXJsSW5wdXQgPSBhZGRDYXJkRm9ybS5xdWVyeVNlbGVjdG9yKFwiI2ltYWdlLXVybC1pbnB1dFwiKTtcbmNvbnN0IG1vZGFsRGl2cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxcIik7XG5jb25zdCBhdmF0YXJFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItZWRpdC1idXR0b25cIik7XG5jb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1lZGl0LWJ1dHRvblwiKTtcbmNvbnN0IHByb2ZpbGVFZGl0Q2xvc2VCdXR0b24gPSBwcm9maWxlRWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtZWRpdC1jbG9zZS1idXR0b25cIlxuKTtcbmNvbnN0IGFkZE5ld0NhcmRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idXR0b25cIik7XG5jb25zdCBhZGRDYXJkQ2xvc2VCdXR0b24gPSBhZGRDYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1jbG9zZS1idXR0b25cIik7XG5jb25zdCBwcmV2aWV3SW1hZ2VDbG9zZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3ByZXZpZXctaW1hZ2UtY2xvc2UtYnV0dG9uXCJcbik7XG5cbmNvbnN0IHByb2ZpbGVFZGl0UG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcbiAgXCIjcHJvZmlsZS1lZGl0LW1vZGFsXCIsXG4gIChmb3JtRGF0YSkgPT4ge1xuICAgIHJldHVybiBhcGlcbiAgICAgIC51cGRhdGVVc2VyUHJvZmlsZSh7XG4gICAgICAgIG5hbWU6IGZvcm1EYXRhLm5hbWUsXG4gICAgICAgIGFib3V0OiBmb3JtRGF0YS5hYm91dCxcbiAgICAgIH0pXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHtcbiAgICAgICAgICBuYW1lOiBmb3JtRGF0YS5uYW1lLFxuICAgICAgICAgIGFib3V0OiBmb3JtRGF0YS5hYm91dCxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgfVxuKTtcblxuY29uc3QgbmV3Q2FyZFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIjYWRkLWNhcmQtbW9kYWxcIiwgKGZvcm1EYXRhKSA9PiB7XG4gIGNvbnN0IG5hbWUgPSBmb3JtRGF0YS50aXRsZTtcbiAgY29uc3QgbGluayA9IGZvcm1EYXRhLnVybDtcblxuICByZXR1cm4gYXBpLmNyZWF0ZUNhcmRzKHsgbmFtZSwgbGluayB9KS50aGVuKChjYXJkRGF0YSkgPT4ge1xuICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gY3JlYXRlQ2FyZChjYXJkRGF0YSk7XG4gICAgc2VjdGlvbi5hZGRJdGVtKGNhcmRFbGVtZW50KTtcbiAgfSk7XG59KTtcbm5ld0NhcmRQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBlZGl0QXZhdGFyUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcbiAgXCIjdXBkYXRlLWF2YXRhci1tb2RhbFwiLFxuICAoZm9ybURhdGEpID0+IHtcbiAgICByZXR1cm4gYXBpLnVwZGF0ZUF2YXRhcih7IGF2YXRhcjogZm9ybURhdGEuYXZhdGFyIH0pLnRoZW4oKHVzZXJEYXRhKSA9PiB7XG4gICAgICB1c2VySW5mby5zZXRVc2VyQXZhdGFyKHsgYXZhdGFyOiB1c2VyRGF0YS5hdmF0YXIgfSk7XG4gICAgfSk7XG4gIH1cbik7XG5cbmF2YXRhckVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgZWRpdEF2YXRhclBvcHVwLm9wZW4oKTtcbn0pO1xuXG5lZGl0QXZhdGFyUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuYWRkTmV3Q2FyZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gbmV3Q2FyZFBvcHVwLm9wZW4oKSk7XG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtZWRpdC1idXR0b25cIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY29uc3QgeyBuYW1lLCBhYm91dCB9ID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcbiAgcHJvZmlsZU5hbWVJbnB1dC52YWx1ZSA9IG5hbWU7XG4gIHByb2ZpbGVUaXRsZUlucHV0LnZhbHVlID0gYWJvdXQ7XG4gIHByb2ZpbGVFZGl0UG9wdXAub3BlbigpO1xufSk7XG5cbmNvbnN0IGVkaXRGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoXG4gIHByb2ZpbGVFZGl0Rm9ybSxcbiAgdmFsaWRhdGlvblNldHRpbmdzXG4pO1xuY29uc3QgYWRkRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGFkZENhcmRGb3JtLCB2YWxpZGF0aW9uU2V0dGluZ3MpO1xuY29uc3QgYXZhdGFyRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKFxuICBhdmF0YXJFZGl0Rm9ybSxcbiAgdmFsaWRhdGlvblNldHRpbmdzXG4pO1xuYWRkRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5lZGl0Rm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5hdmF0YXJGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcblxuY29uc3QgaGFuZGxlQ2FyZEZvcm1TdWJtaXQgPSAoZm9ybURhdGEpID0+IHtcbiAgY29uc3QgbmFtZSA9IGZvcm1EYXRhLnRpdGxlO1xuICBjb25zdCBsaW5rID0gZm9ybURhdGEudXJsO1xuICAvLyBjb25zdCBhdmF0YXIgPSBmb3JtRGF0YS51cmw7XG4gIHJldHVybiBhcGkuY3JlYXRlQ2FyZHMoeyBuYW1lLCBsaW5rIH0pLnRoZW4oKGNhcmREYXRhKSA9PiB7XG4gICAgY29uc3QgY2FyZEVsZW1lbnQgPSBjcmVhdGVDYXJkKGNhcmREYXRhKTtcbiAgICBzZWN0aW9uLmFkZEl0ZW0oY2FyZEVsZW1lbnQpO1xuICB9KTtcbn07XG5cbmNvbnN0IGhhbmRsZUNhcmREZWxldGUgPSAoY2FyZElkLCBjYXJkRWxlbWVudCkgPT4ge1xuICBjb25maXJtRGVsZXRlUG9wdXAub3BlbihjYXJkSWQsIGNhcmRFbGVtZW50KTtcbn07XG5cbnByb2ZpbGVFZGl0UG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuY29uc3QgcHJldmlld0ltYWdlTW9kYWwgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoXCIjcHJldmlldy1pbWFnZS1tb2RhbFwiKTtcbnByZXZpZXdJbWFnZU1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmZ1bmN0aW9uIGhhbmRsZUltYWdlQ2xpY2sobmFtZSwgbGluaykge1xuICBwcmV2aWV3SW1hZ2VNb2RhbC5vcGVuKHsgbmFtZSwgbGluayB9KTtcbn1cblxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oe1xuICBwcm9maWxlTmFtZVNlbGVjdG9yOiBcIi5wcm9maWxlX19uYW1lXCIsXG4gIGFib3V0U2VsZWN0b3I6IFwiLnByb2ZpbGVfX3RpdGxlXCIsXG4gIGF2YXRhclNlbGVjdG9yOiBcIi5wcm9maWxlX19hdmF0YXJcIixcbn0pO1xuXG5mdW5jdGlvbiByZW5kZXJDYXJkKGNhcmREYXRhLCBjYXJkTGlzdEVsKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY3JlYXRlQ2FyZChjYXJkRGF0YSk7XG4gIGNhcmRMaXN0RWwucHJlcGVuZChjYXJkRWxlbWVudCk7XG59XG5cbi8vIE5FVyBWRVJTSU9OIE9GIERFTEVUSU9OXG5cbmNvbnN0IGNvbmZpcm1EZWxldGVQb3B1cCA9IG5ldyBQb3B1cFdpdGhDb25maXJtYXRpb24oXG4gIFwiLm1vZGFsX19jb25maXJtXCIsXG4gIChjYXJkSWQsIGNhcmRFbGVtZW50KSA9PiB7XG4gICAgcmV0dXJuIGFwaVxuICAgICAgLmRlbGV0ZUNhcmQoY2FyZElkKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBjYXJkRWxlbWVudC5yZW1vdmUoKTsgLy8gUmVtb3ZlIHRoZSBjYXJkIGZyb20gdGhlIERPTVxuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEVSUk9SIERFTEVUSU5HIENBUkQgJHtlcnJ9YCk7XG4gICAgICB9KTtcbiAgfVxuKTtcblxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlQ2xpY2soY2FyZElkLCBjYXJkRWxlbWVudCkge1xuICBjb25maXJtRGVsZXRlUG9wdXAub3BlbihjYXJkSWQsIGNhcmRFbGVtZW50KTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlQ2FyZChpdGVtKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gbmV3IENhcmQoXG4gICAgeyAuLi5pdGVtLCBpc0xpa2VkOiBpdGVtLmlzTGlrZWQgfSxcbiAgICBcIiNjYXJkLXRlbXBsYXRlXCIsXG4gICAgaGFuZGxlSW1hZ2VDbGljayxcbiAgICBoYW5kbGVEZWxldGVDbGljayxcbiAgICBoYW5kbGVMaWtlQ2xpY2tcbiAgKTtcbiAgcmV0dXJuIGNhcmRFbGVtZW50LmdldFZpZXcoKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlTGlrZUNsaWNrKGNhcmQpIHtcbiAgaWYgKGNhcmQuaXNMaWtlZCkge1xuICAgIGFwaVxuICAgICAgLmRpc2xpa2VBQ2FyZChjYXJkLl9pZClcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgY2FyZC51bmxpa2VDYXJkKCk7XG4gICAgICAgIGNhcmQuaXNMaWtlZCA9IGZhbHNlO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEVSUk9SIERJU0xJS0lORyBDQVJEICR7ZXJyfWApO1xuICAgICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgYXBpXG4gICAgICAubGlrZUFDYXJkKGNhcmQuX2lkKVxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgY2FyZC5saWtlQ2FyZCgpO1xuICAgICAgICBjYXJkLmlzTGlrZWQgPSB0cnVlO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEVSUk9SIExJS0lORyBDQVJEICR7ZXJyfWApO1xuICAgICAgfSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gaGFuZGxlTGlrZUljb24oY2FyZElkLCBpc0xpa2VkKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtaWQ9XCIke2NhcmRJZH1cIl1gKTtcbiAgaWYgKGNhcmRFbGVtZW50KSB7XG4gICAgY29uc3QgY2FyZCA9IGNhcmRFbGVtZW50Ll9fY2FyZEluc3RhbmNlO1xuICAgIGlmIChcbiAgICAgIGNhcmQgJiZcbiAgICAgIHR5cGVvZiBjYXJkLmxpa2VDYXJkID09PSBcImZ1bmN0aW9uXCIgJiZcbiAgICAgIHR5cGVvZiBjYXJkLnVubGlrZUNhcmQgPT09IFwiZnVuY3Rpb25cIlxuICAgICkge1xuICAgICAgaWYgKGlzTGlrZWQpIHtcbiAgICAgICAgY2FyZC5saWtlQ2FyZCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FyZC51bmxpa2VDYXJkKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHJlbmRlcmVyKGl0ZW0pIHtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjcmVhdGVDYXJkKGl0ZW0pO1xuICBzZWN0aW9uLmFkZEl0ZW0oY2FyZEVsZW1lbnQpO1xufVxuXG5sZXQgc2VjdGlvbjtcblxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiNjQyMzcwYTQtY2ViNi00ZDA0LWJjODMtMjQ2ZDYxYTRjMzhlXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcblxuYXBpXG4gIC5nZXRJbml0aWFsQ2FyZHMoKVxuICAudGhlbigoY2FyZHMpID0+IHtcbiAgICBjb25zb2xlLmxvZyhcIkZldGNoZWQgY2FyZHM6XCIsIGNhcmRzKTtcbiAgICBzZWN0aW9uID0gbmV3IFNlY3Rpb24oeyBpdGVtczogY2FyZHMucmV2ZXJzZSgpLCByZW5kZXJlciB9LCBcIi5jYXJkc1wiKTtcbiAgICBzZWN0aW9uLnJlbmRlckl0ZW1zKCk7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5lcnJvcihgRVJST1IgRkVUQ0hJTkcgQ0FSRFMgJHtlcnJ9YCk7XG4gIH0pO1xuXG5hcGlcbiAgLmdldFVzZXJJbmZvKClcbiAgLnRoZW4oKHVzZXJEYXRhKSA9PiB7XG4gICAgY29uc29sZS5sb2coXCJGZXRjaGVkIHVzZXIgZGF0YTpcIiwgdXNlckRhdGEpO1xuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHtcbiAgICAgIG5hbWU6IHVzZXJEYXRhLm5hbWUsXG4gICAgICBhYm91dDogdXNlckRhdGEuYWJvdXQsXG4gICAgfSk7XG4gICAgdXNlckluZm8uc2V0VXNlckF2YXRhcih7XG4gICAgICBhdmF0YXI6IHVzZXJEYXRhLmF2YXRhcixcbiAgICB9KTtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmVycm9yKGBFUlJPUiBGRVRDSElORyBVU0VSIElORk8gJHtlcnJ9YCk7XG4gIH0pO1xuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5faW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21vZGFsLWltYWdlXCIpO1xuICAgIHRoaXMuX2NhcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21vZGFsLXByZXZpZXctaW1hZ2UtdGl0bGVcIik7XG4gIH1cblxuICBvcGVuKGRhdGEpIHtcbiAgICB0aGlzLl9pbWFnZS5zcmMgPSBkYXRhLmxpbms7XG4gICAgdGhpcy5faW1hZ2UuYWx0ID0gZGF0YS5uYW1lO1xuICAgIHRoaXMuX2NhcHRpb24udGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgc3VwZXIub3BlbigpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFBvcHVwV2l0aEltYWdlO1xuIiwiY2xhc3MgVXNlckluZm8ge1xuICBjb25zdHJ1Y3Rvcih7IHByb2ZpbGVOYW1lU2VsZWN0b3IsIGFib3V0U2VsZWN0b3IsIGF2YXRhclNlbGVjdG9yIH0pIHtcbiAgICB0aGlzLl9wcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocHJvZmlsZU5hbWVTZWxlY3Rvcik7XG4gICAgdGhpcy5fcHJvZmlsZVRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhYm91dFNlbGVjdG9yKTtcbiAgICB0aGlzLl9wcm9maWxlQXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhdmF0YXJTZWxlY3Rvcik7XG4gIH1cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50LFxuICAgICAgYWJvdXQ6IHRoaXMuX3Byb2ZpbGVUaXRsZS50ZXh0Q29udGVudCxcbiAgICAgIGF2YXRhcjogdGhpcy5fcHJvZmlsZUF2YXRhci51cmwsXG4gICAgfTtcbiAgfVxuXG4gIHNldFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xuICAgIHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gbmFtZTtcbiAgICB0aGlzLl9wcm9maWxlVGl0bGUudGV4dENvbnRlbnQgPSBhYm91dDtcbiAgfVxuXG4gIHNldFVzZXJBdmF0YXIoeyBhdmF0YXIgfSkge1xuICAgIHRoaXMuX3Byb2ZpbGVBdmF0YXIuc3JjID0gYXZhdGFyO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFVzZXJJbmZvO1xuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmNsYXNzIFBvcHVwV2l0aENvbmZpcm1hdGlvbiBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgaGFuZGxlQ29uZmlybSkge1xuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuICAgIHRoaXMuX2hhbmRsZUNvbmZpcm0gPSBoYW5kbGVDb25maXJtO1xuICAgIHRoaXMuX2NvbmZpcm1CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIubW9kYWxfX3NhdmUtYnV0dG9uX2NvbmZpcm1hdGlvblwiXG4gICAgKTtcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgb3BlbihjYXJkSWQsIGNhcmRFbGVtZW50KSB7XG4gICAgc3VwZXIub3BlbigpO1xuICAgIHRoaXMuX2NhcmRJZCA9IGNhcmRJZDtcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IGNhcmRFbGVtZW50O1xuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fY29uZmlybUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5faGFuZGxlQ29uZmlybSh0aGlzLl9jYXJkSWQsIHRoaXMuX2NhcmRFbGVtZW50KVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBEZWxldGluZyBDYXJkczpcIiwgZXJyKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUG9wdXBXaXRoQ29uZmlybWF0aW9uO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIF9oYW5kbGVSZXNwb25zZShyZXMpIHtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KFxuICAgICAgICBuZXcgRXJyb3IoYEVycm9yICR7cmVzLnN0YXR1c306ICR7cmVzLnN0YXR1c1RleHR9YClcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiByZXMuanNvbigpO1xuICB9XG5cbiAgLy8gKipDYXJkcyoqIC8vXG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9oYW5kbGVSZXNwb25zZSk7XG4gIH1cblxuICBjcmVhdGVDYXJkcyhjYXJkRGF0YSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoY2FyZERhdGEpLFxuICAgIH0pLnRoZW4odGhpcy5faGFuZGxlUmVzcG9uc2UpO1xuICB9XG5cbiAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2hhbmRsZVJlc3BvbnNlKTtcbiAgfVxuXG4gIGxpa2VBQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2hhbmRsZVJlc3BvbnNlKTtcbiAgfVxuXG4gIGRpc2xpa2VBQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2hhbmRsZVJlc3BvbnNlKTtcbiAgfVxuXG4gIC8vICoqVXNlciBJbmZvKiogLy9cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5faGFuZGxlUmVzcG9uc2UpO1xuICB9XG5cbiAgdXBkYXRlVXNlclByb2ZpbGUodXNlckRhdGEpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh1c2VyRGF0YSksXG4gICAgfSkudGhlbih0aGlzLl9oYW5kbGVSZXNwb25zZSk7XG4gIH1cblxuICB1cGRhdGVBdmF0YXIoeyBhdmF0YXIgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGF2YXRhcjogYXZhdGFyIH0pLFxuICAgIH0pLnRoZW4odGhpcy5faGFuZGxlUmVzcG9uc2UpO1xuICB9XG59XG4iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwiX3JlZiIsImNhcmRTZWxlY3RvciIsImhhbmRsZUltYWdlQ2xpY2siLCJoYW5kbGVEZWxldGVDbGljayIsImhhbmRsZUxpa2VDbGljayIsIm5hbWUiLCJsaW5rIiwiX2lkIiwiaXNMaWtlZCIsInRoaXMiLCJfbmFtZSIsIl9saW5rIiwiX2NhcmRTZWxlY3RvciIsIl9oYW5kbGVJbWFnZUNsaWNrIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiX2NhcmRFbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwic3RvcFByb3BhZ2F0aW9uIiwibGlrZUNhcmQiLCJjbGFzc0xpc3QiLCJhZGQiLCJ1bmxpa2VDYXJkIiwicmVtb3ZlIiwiaGFuZGxlTGlrZUljb24iLCJ1bmRlZmluZWQiLCJoYW5kbGVEZWxldGVDYXJkIiwiX2dldFRlbXBsYXRlIiwidGVtcGxhdGVFbGVtZW50IiwiZG9jdW1lbnQiLCJFcnJvciIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJnZXRWaWV3Iiwic2V0QXR0cmlidXRlIiwiY2FyZEltYWdlIiwic3JjIiwiYWx0IiwidGV4dENvbnRlbnQiLCJGb3JtVmFsaWRhdG9yIiwiZm9ybUVsZW1lbnQiLCJzZXR0aW5ncyIsIl9mb3JtRWwiLCJfZm9ybVNlbGVjdG9yIiwiZm9ybVNlbGVjdG9yIiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsImlucHV0RWwiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX3Nob3dJbnB1dEVycm9yIiwiX2hpZGVJbnB1dEVycm9yIiwiZXJyb3JNZXNzYWdlRWwiLCJpZCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2hhc0ludmFsaWRJbnB1dCIsIl9pbnB1dEVscyIsInNvbWUiLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJkaXNhYmxlQnV0dG9uIiwiX2VuYWJsZUJ1dHRvbiIsIl9zdWJtaXRCdXR0b24iLCJkaXNhYmxlZCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZW5hYmxlVmFsaWRhdGlvbiIsIlBvcHVwIiwicG9wdXBTZWxlY3RvciIsIl9wb3B1cEVsZW1lbnQiLCJfaGFuZGxlRXNjQ2xvc2UiLCJiaW5kIiwib3BlbiIsImNsb3NlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2dCIsImtleSIsInNldEV2ZW50TGlzdGVuZXJzIiwidGFyZ2V0IiwiY29udGFpbnMiLCJoYW5kbGVDYXJkRm9ybVN1Ym1pdCIsInN1cGVyIiwiX3BvcHVwRm9ybSIsIl9oYW5kbGVDYXJkRm9ybVN1Ym1pdCIsIl9pbnB1dExpc3QiLCJfc3VibWl0QnV0dG9uT3JpZ2luYWxUZXh0IiwicmVuZGVyTG9hZGluZyIsImlzTG9hZGluZyIsIl9nZXRJbnB1dFZhbHVlcyIsImZvcm1WYWx1ZXMiLCJpbnB1dCIsInZhbHVlIiwiZGlzYWJsZVN1Ym1pdEJ1dHRvbiIsImVuYWJsZVN1Ym1pdEJ1dHRvbiIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJmb3JtRGF0YSIsInRoZW4iLCJjb25zb2xlIiwibG9nIiwicmVzZXQiLCJjYXRjaCIsImVyciIsImVycm9yIiwiZmluYWxseSIsInZhbGlkYXRpb25TZXR0aW5ncyIsImNvbnRhaW5lclNlbGVjdG9yIiwiaXRlbXMiLCJyZW5kZXJlciIsIl9pdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJyZW5kZXJJdGVtcyIsIml0ZW0iLCJhZGRJdGVtIiwiZWxlbWVudCIsInByZXBlbmQiLCJwcm9maWxlTmFtZUlucHV0IiwicHJvZmlsZVRpdGxlSW5wdXQiLCJwcm9maWxlRWRpdE1vZGFsIiwicHJvZmlsZUVkaXRGb3JtIiwiYXZhdGFyRWRpdEZvcm0iLCJhZGRDYXJkTW9kYWwiLCJhZGRDYXJkRm9ybSIsImF2YXRhckVkaXRCdXR0b24iLCJmaXJzdEVsZW1lbnRDaGlsZCIsImFkZE5ld0NhcmRCdXR0b24iLCJwcm9maWxlRWRpdFBvcHVwIiwiUG9wdXBXaXRoRm9ybSIsImFwaSIsInVwZGF0ZVVzZXJQcm9maWxlIiwiYWJvdXQiLCJ1c2VySW5mbyIsInNldFVzZXJJbmZvIiwibmV3Q2FyZFBvcHVwIiwidGl0bGUiLCJ1cmwiLCJjcmVhdGVDYXJkcyIsImNhcmREYXRhIiwiY2FyZEVsZW1lbnQiLCJjcmVhdGVDYXJkIiwic2VjdGlvbiIsImVkaXRBdmF0YXJQb3B1cCIsInVwZGF0ZUF2YXRhciIsImF2YXRhciIsInVzZXJEYXRhIiwic2V0VXNlckF2YXRhciIsImdldFVzZXJJbmZvIiwiZWRpdEZvcm1WYWxpZGF0b3IiLCJhZGRGb3JtVmFsaWRhdG9yIiwiYXZhdGFyRm9ybVZhbGlkYXRvciIsInByZXZpZXdJbWFnZU1vZGFsIiwiX2ltYWdlIiwiX2NhcHRpb24iLCJkYXRhIiwicHJvZmlsZU5hbWVTZWxlY3RvciIsImFib3V0U2VsZWN0b3IiLCJhdmF0YXJTZWxlY3RvciIsIl9wcm9maWxlTmFtZSIsIl9wcm9maWxlVGl0bGUiLCJfcHJvZmlsZUF2YXRhciIsIl9yZWYyIiwiX3JlZjMiLCJjb25maXJtRGVsZXRlUG9wdXAiLCJoYW5kbGVDb25maXJtIiwiX2hhbmRsZUNvbmZpcm0iLCJfY29uZmlybUJ1dHRvbiIsImNhcmRJZCIsIl9jYXJkSWQiLCJkZWxldGVDYXJkIiwiY2FyZCIsImRpc2xpa2VBQ2FyZCIsImxpa2VBQ2FyZCIsImJhc2VVcmwiLCJoZWFkZXJzIiwiX2Jhc2VVcmwiLCJfaGVhZGVycyIsIl9oYW5kbGVSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJzdGF0dXNUZXh0IiwiZ2V0SW5pdGlhbENhcmRzIiwiZmV0Y2giLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImF1dGhvcml6YXRpb24iLCJjYXJkcyIsIlNlY3Rpb24iLCJyZXZlcnNlIl0sInNvdXJjZVJvb3QiOiIifQ==